# Darknet Trade Message Classification (Nemesis)

This repository contains an end-to-end notebook pipeline for **multi-class text classification** of darknet marketplace listings.
The main goal is to compare **traditional ML baselines (TF‑IDF + scikit‑learn)** against **Transformer fine-tuning (Hugging Face Trainer)**, then generate **comparison tables, error analysis outputs, and paper-ready figures/tables**.

> Note: The repo contains research artifacts and may reference Tor / darknet sources. It does **not** include any crawling code.

## Dataset

- Primary raw input: `nemesis.json`
  - Contains pages with fields such as `title`, `url`, `text`, `timestamp` (and category fields used for labeling).
- The training dataset is generated by the preprocessing notebook:
  - Output: `data/english_clean.csv`

## Notebook Pipeline (recommended run order)

1) `labeling_and_preprocessing.ipynb`
   - Input: `nemesis.json`
   - Outputs: `data/english_clean.csv`, `data/preprocessing_summary.txt`

2) `baseline_models.ipynb`
   - Input: `data/english_clean.csv`
   - Trains scikit‑learn baselines using **`clean_text`** and TF‑IDF.
   - Outputs: `models/baseline_results.json`, `models/baseline_results_summary.csv`, `models/*.pkl`, `models/baseline_comparison.png`

3) `advanced_model_bert.ipynb`
   - Input: `data/english_clean.csv`
   - Fine-tunes a Transformer (default: `current_model_name = 'RoBERTa'`) using Hugging Face Trainer.
   - Uses **`combined_text`** if present (otherwise falls back to `clean_text`).
   - Outputs (under `models/bert_models/`):
     - `label_encoder.pkl`
     - `<model>_final/` (e.g., `roberta_final/`)
     - `<model>_results.json` (e.g., `roberta_results.json`)
     - `<model>_confusion_matrix.png`

4) `4_evaluation_and_error_analysis.ipynb`
   - Inputs:
     - `models/baseline_results.json`
     - `models/bert_models/*_results.json` (if you trained Transformers)
   - Outputs (under `outputs/`):
     - `all_models_comparison.csv`
     - `misclassified_examples.csv`
     - `low_confidence_predictions.csv`
     - `top20_misclassified_for_paper.csv`
     - `top20_misclassified_latex.txt`

5) `5_paper_diagrams_and_visualizations.ipynb`
   - Reads outputs from step (4) and creates paper figures.
   - Output: PNG figures under `outputs/` (e.g., `fig1_system_architecture.png`).

6) `6_comprehensive_metrics_for_paper.ipynb`
   - Creates paper-ready tables.
   - Output directory (created by the notebook): `metrics_tables/`
     - `table1_standard_metrics.{csv,tex}`
     - `table2_advanced_metrics.{csv,tex}`
     - `table3_confusion_stats.{csv,tex}`
     - plus additional tables and summary files.

### Optional / exploratory notebook

- `explore.ipynb`
  - This is exploratory and may assume a local folder `./textpages`.
  - It is not required for the main pipeline that starts from `nemesis.json`.

## Setup

### 1) Create and activate a virtual environment (Windows PowerShell)

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
python -m pip install --upgrade pip
```

### 2) Install dependencies

Core packages (preprocessing + baselines + plotting):

```powershell
pip install jupyter pandas numpy scikit-learn matplotlib seaborn tqdm joblib
```

Transformer fine-tuning (optional but required for `advanced_model_bert.ipynb`):

```powershell
pip install torch transformers datasets accelerate
```

Notes:
- If you have an NVIDIA GPU, install the CUDA-enabled `torch` build that matches your CUDA version.
- The notebook uses `fp16=torch.cuda.is_available()` automatically when CUDA is available.

## How to run

Launch Jupyter:

```powershell
jupyter notebook
```

Then open each notebook and run all cells in the pipeline order listed above.

## Output folders

These folders are created by the notebooks when you run them (they may not exist in a fresh clone):

- `data/`
- `models/`
- `models/bert_models/`
- `outputs/`
- `metrics_tables/`

## License / Disclaimer

This repository is for research/analysis purposes. Ensure you comply with all applicable laws and institutional policies when handling darknet-related data.
# Drug trade in Enslish on Tor

http://nemesis555nchzn2dogee6mlc7xxgeeshqirmh3yzn4lo5cnd4s5a4yd.onion/
https://zenodo.org/records/15300503

Nemesis marketplace offers larger variety of illegal drugs.

The "textpages" folder contains the web pages' readable text versions of pages (1,334).

All of the web pages are included in the JSON file in a machine-readable format.
